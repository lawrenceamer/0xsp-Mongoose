{

CVE-2019-0836
CVE-2019-0841
CVE-2019-1064
CVE-2019-1130
CVE-2019-1253
CVE-2019-1385
CVE-2019-1388
CVE-2019-1405
CVE-2019-1315
CVE-2020-0787
CVE-2020-0796
CVE-2020-0797

}

unit exploitchecker;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils,variants,comobj,core;


function IsUpdateInstalled(KB: String): Boolean;
procedure windows_auditing;
const
  BUILD_FREE_VAL = word($F000);

  BUILD_FREE_STR = 'Free build';
  BUILD_CHKD_STR = 'Checked build';

  BuildString    : pchar = BUILD_FREE_STR;

var
  MajorVersion   : DWORD;
  MinorVersion   : DWORD;
  BuildNumberRec : packed record
                     BuildNumber : word;
                     Build       : word;
                   end;
  Build          : DWORD absolute BuildNumberRec;




procedure RtlGetNtVersionNumbers(out MajorVersion : DWORD;
                                out MinorVersion : DWORD;
                                out Build        : DWORD);
         stdcall; external 'ntdll.dll';


implementation


function IsUpdateInstalled(KB: String): Boolean;
var
  UpdateSession: Variant;
  UpdateSearcher: Variant;
  SearchResult: Variant;
  I: Integer;
begin
  UpdateSession := CreateOleObject('Microsoft.Update.Session');
  UpdateSearcher := UpdateSession.CreateUpdateSearcher();
  SearchResult := UpdateSearcher.Search('IsInstalled=1');
  for I := 0 to SearchResult.Updates.Count - 1 do
  begin
    if SearchResult.Updates.Item(I).KBArticleIDs.Item(0) = KB then
    begin
      Result := true;
      Exit;
    end;
  end;
  Result := false;
end;


function CVE_2020_0797_1909:string;
var
 ip,os:string;
begin
  ip := getlocalip;
  os := osver;
 if IsUpdateInstalled('4540673') then begin
  writeln('[+] vulnerability is patched with KB4540673')
  end else begin
    writeln('[+] system is vulnerable to CVE-2020-0797');
    postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2020-0797</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2020_0797_1607:string;
var
 ip,os:string;
begin
  ip := getlocalip;
  os := osver;
 if IsUpdateInstalled('4540670') then begin
  writeln('[+] vulnerability is patched with KB4540670')
  end else begin
    writeln('[+] system is vulnerable to CVE-2020-0797');
    postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2020-0797</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2019_0836_1809:String;
var
 ip,os:string;
begin
  ip := getlocalip;
  os := osver;
 if IsUpdateInstalled('4493509') then begin
  writeln('[+] vulnerability is patched with KB4493509')
  end else begin
    writeln('[+] system is vulnerable to CVE-2019-0836');
    postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-0836</b></font>',ip,os,'12');   //this will send information into API

end;
end;

function CVE_2019_0841_1809:String;
var
 ip,os:string;
begin
  ip := getlocalip;
  os := osver;
   if IsUpdateInstalled('4493509') then begin
    writeln('[+] vulnerability is patched with KB4493509')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-0841');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-0836</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2019_1064_1809:String;
var
 ip,os:string;
begin
   ip := getlocalip;
  os := osver;
   if IsUpdateInstalled('4503327') then begin
    writeln('[+] vulnerability is patched with KB4503327')
    end else begin
      writeln('[+] system is vulnerable to CVE-2019-1064');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1064</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2019_1064_1903:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4503293') then begin
    writeln('[+] vulnerability is patched with KB4503293')
    end else begin
      writeln('[+] system is vulnerable to CVE-2019-1064');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1064</b></font>',ip,os,'12');   //this will send information into API
end;
end;


function CVE_2019_1130_1903:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4507453') then begin
    writeln('[+] vulnerability is patched with KB4507453')
    end else begin
      writeln('[+] system is vulnerable to CVE-2019-1130');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1130</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2019_1130_1809:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4507469') then begin
    writeln('[+] vulnerability is patched with KB4507469')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1130');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1130</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2019_1253_1903:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4515384') then begin
    writeln('[+] vulnerability is patched with KB4515384')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1253');
      postrequest('<font color="red"><b>[!] system is vulnerable to  CVE-2019-1253</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2019_1253_1809:String;
var
 ip,os:string;
begin
    ip := getlocalip;
    os := osver;
   if IsUpdateInstalled('4512578') then begin
    writeln('[+] vulnerability is patched with KB4512578')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1253');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1253</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2019_1315_1903:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4517389') then begin
    writeln('[+] vulnerability is patched with KB4517389')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1315 Windows Error Reporting Manager Elevation of Privilege Vulnerability');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1315</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2019_1315_1809:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4519338') then begin
    writeln('[+] vulnerability is patched with KB4519338')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1315 Windows Error Reporting Manager Elevation of Privilege Vulnerability');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1315 Windows Error Reporting Manager Elevation of Privilege Vulnerability</b></font>',ip,os,'12');   //this will send information into API
end;
end;


function CVE_2019_1385_1903:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4524570') then begin
    writeln('[+] vulnerability is patched with KB4524570')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1385 Windows Certificate Dialog Elevation of Privilege Vulnerability');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1385 Windows Certificate Dialog Elevation of Privilege Vulnerability</b></font>',ip,os,'12');   //this will send information into API
end;
end;
function CVE_2019_1385_1809:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4523205') then begin
    writeln('[+] vulnerability is patched with KB4523205')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1385 Windows Certificate Dialog Elevation of Privilege Vulnerability');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1385 Windows Certificate Dialog Elevation of Privilege Vulnerability</b></font>',ip,os,'12');   //this will send information into API
end;
end;

function CVE_2019_1388_1809:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4523205') then begin
    writeln('[+] vulnerability is patched with KB4523205')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1388 Windows Certificate Dialog Elevation of Privilege Vulnerability');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1388 Windows Certificate Dialog Elevation of Privilege Vulnerability</b></font>',ip,os,'12');   //this will send information into API
end;
end;
function CVE_2019_1388_1903:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4524570') then begin
    writeln('[+] vulnerability is patched with KB4524570')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1388 Windows Certificate Dialog Elevation of Privilege Vulnerability');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1388 Windows Certificate Dialog Elevation of Privilege Vulnerability</b></font>',ip,os,'12');   //this will send information into API
end;
end;
function CVE_2019_1405_1809:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4523205') then begin
    writeln('[+] vulnerability is patched with KB4523205')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1405 Windows UPnP Service Elevation of Privilege Vulnerability');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1405 Windows UPnP Service Elevation of Privilege Vulnerability</b></font>',ip,os,'12');   //this will send information into API
end;
end;


function CVE_2019_1405_1903:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4524570') then begin
    writeln('[+] vulnerability is patched with KB4524570')
    end else begin
      writeln('[+] it is vulnerable to CVE-2019-1405 Windows UPnP Service Elevation of Privilege Vulnerability');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2019-1405 Windows UPnP Service Elevation of Privilege Vulnerability</b></font>',ip,os,'12');   //this will send information into API
end;
end;


function CVE_2020_0787_1809:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4538461') then begin
    writeln('[+] vulnerability is patched with KB4538461')
    end else begin
      writeln('[+] it is vulnerable to CVE-2020-0787');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2020-0787</b></font>',ip,os,'12');   //this will send information into API
end;
end;
function CVE_2020_0787_1903:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4540673') then begin
    writeln('[+] vulnerability is patched with KB4540673')
    end else begin
      writeln('[+] it is vulnerable to CVE-2020-0787 ');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2020-0787</b></font>',ip,os,'12');   //this will send information into API
end;
end;
function CVE_2020_0787_1909:String;
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
   if IsUpdateInstalled('4540673') then begin
    writeln('[+] vulnerability is patched with KB4540673')
    end else begin
      writeln('[+] it is vulnerable to CVE-2020-0787 ');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2020-0787</b></font>',ip,os,'12');   //this will send information into API
end;
end;


function cve_2020_0796:string;//https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0796
var
 ip,os:string;
begin
   ip := getlocalip;
   os := osver;
  if IsUpdateInstalled('4551762') then begin
    writeln('[+] vulnerability is patched with KB4551762')
    end else begin
      writeln('[+] it is vulnerable to CVE-2020-0796 ');
      postrequest('<font color="red"><b>[!] system is vulnerable to CVE-2020-0796</b></font>',ip,os,'12');   //this will send information into API
  end;
end;

procedure windows_auditing;
var
  osid:dword;
begin
 RtlGetNtVersionNumbers(MajorVersion, MinorVersion, Build);
 osid := BuildNumberRec.BuildNumber;
 if (osid =  1903)  OR (osid = 1909)   then begin  //CVE-2020-0796
   cve_2020_0796;   //both with same KB number
 end;
 if (osid = 1903)  then begin
   CVE_2020_0787_1903;
   CVE_2019_1405_1903;
   CVE_2019_1388_1903;
   CVE_2019_1385_1903;
   CVE_2019_1315_1903;
   CVE_2019_1253_1903;
   CVE_2019_1130_1903;
   CVE_2019_1064_1903;
   end;
  if (osid = 1909)  then begin
   CVE_2020_0787_1909;
   end;
  if (osid = 1809)  then begin
   CVE_2020_0787_1809;
   CVE_2019_1405_1809;
   CVE_2019_1388_1809;
   CVE_2019_1385_1809;
   CVE_2019_1315_1809;
   CVE_2019_1253_1809;
   CVE_2019_1130_1809;
   CVE_2019_1064_1809;
   CVE_2019_0841_1809;
   CVE_2019_0836_1809;
   end;
  if (osid = 1909) then begin   //Windows Server, version 1909 (Server Core installation)
   CVE_2020_0797_1909;
  end;

 end;



end.

